(function (n) { "use strict"; function h(n, t) { var a, r, h, f, l, o, e, i, s; if (a = this, r = n.data, !r) return f = new Error, n.callback && typeof n.callback == "function" ? n.callback(f) : null; if (r.status === "error" || r.status === "fail") return r.response && r.response.responseJSON && (r = r.response.responseJSON, r.hasOwnProperty("message") ? h = r.message : r.hasOwnProperty("error") && (h = r.error)), f = new Error(h), f.body = n.data, t.reject(f), n.callback && typeof n.callback == "function" ? n.callback(f) : null; if (r.status !== "success") return f = new Error, f.body = r, t.reject(f), n.callback && typeof n.callback == "function" ? n.callback(f) : null; if (i = r.response, u(n.cache) && i && p(i), e = i.request, delete i.request, i.access_token ? s = { access_token: i.access_token } : i.oauth_token && i.oauth_token_secret && (s = { oauth_token: i.oauth_token, oauth_token_secret: i.oauth_token_secret }), e && e.required) for (l in e.required) s[e.required[l]] = i[e.required[l]]; return o = function (n) { return c(s, e, n) }, i.get = o("GET"), i.post = o("POST"), i.put = o("PUT"), i.patch = o("PATCH"), i.del = o("DELETE"), t.resolve(i), n.callback && typeof n.callback == "function" ? n.callback(null, i) : null } function a(i) { n.Portal.http = function (n) { function e() { var n = r.request || {}, o, e; if (!n.cors) { r.url = encodeURIComponent(r.url); r.url[0] !== "/" && (r.url = "/" + r.url); r.url = t.base + t.api + "/" + t.version + "/" + r.url; r.headers = r.headers || {}; r.oauth.tokens.oauth_token && r.oauth.tokens.oauth_token_secret && (r.headers.oauth += "&oauthv=1"); for (o in r.oauth.tokens) r.headers.oauth += "&" + encodeURIComponent(o) + "=" + encodeURIComponent(r.oauth.tokens[o]); return delete r.oauth, i.ajax(r) } if (r.oauth.tokens) { if (r.oauth.tokens.access_token && (r.oauth.tokens.token = r.oauth.tokens.access_token), r.url.match(/^[a-z]{2,16}:\/\//) || (r.url[0] !== "/" && (r.url = "/" + r.url), r.url = t.base + t.api + "/" + t.version + "/" + r.url), r.url = f(r.url, r.oauth.tokens, n.parameters), n.query) { e = []; for (u in n.query) e.push(encodeURIComponent(u) + "=" + encodeURIComponent(f(n.query[u], r.oauth.tokens, n.parameters))); e = e.join("&"); r.url += r.url.indexOf("?") !== -1 ? "&" + e : "?" + e } if (n.headers) { r.headers = r.headers || {}; for (u in n.headers) r.headers[u] = f(n.headers[u], r.oauth.tokens, n.parameters) } else r.headers; return delete r.oauth, i.ajax(r) } } var r = {}; for (var u in n) r[u] = n[u]; return e() } } var t = { url: "http://localhost:26831", api: "/api", version: "", options: { cache: !1, loadJQuery: !0 } }, e = function (n) { var t = new Date; t.setTime(t.getTime() - 864e5); document.cookie = n + "=; expires=" + t.toGMTString() + "; path=/" }, v = function (n, t, i) { var r, u; e(n); r = new Date; r.setTime(r.getTime() + (i || 1200) * 1e3); u = "; expires=" + r.toGMTString(); document.cookie = n + "=" + t + u + "; path=/" }, y = function (n) { for (var t, r = n + "=", u = document.cookie.split(";"), i = 0; i < u.length; i++) { for (t = u[i]; t.charAt(0) === " ";) t = t.substring(1, t.length); if (t.indexOf(r) === 0) return t.substring(r.length, t.length) } return null }, p = function (n) { v(".wps_api_auth", encodeURIComponent(JSON.stringify(n)), n.expires_in - 10 || 3600) }, u = function (n) { return typeof n == "undefined" ? t.options.cache : n }, o = function (n, t) { var f, i, r; if (u(t)) { if (t = y(".wps_api_auth"), !t) return !1; t = decodeURIComponent(t) } if (typeof t == "string") try { t = JSON.parse(t) } catch (e) { return f = e, !1 } if (typeof t == "object") { r = {}; for (i in t) i !== "request" && typeof t[i] != "function" && (r[i] = t[i]); return n.create(r, t.request) } return !1 }, s = function (n) { if (n.match(/^.{2,5}:\/\//)) return n; if (n[0] === "/") return document.location.protocol + "//" + document.location.host + n; var t = document.location.protocol + "//" + document.location.host + document.location.pathname; return t[t.length - 1] !== "/" && n[0] !== "#" ? t + "/" + n : t + n }, f = function (n, t, i) { return n = n.replace(/\{\{(.*?)\}\}/g, function (n, i) { return t[i] || "" }), i && (n = n.replace(/\{(.*?)\}/g, function (n, t) { return i[t] || "" })), n }, c = function (i, r, u) { return function (f, e) { var o = {}; for (var s in t.options) o[s] = t.options[s]; if (typeof f == "string") { if (typeof e == "object") for (s in e) o[s] = e[s]; o.url = f } else if (typeof f == "object") for (s in f) o[s] = f[s]; return o.type = o.type || u, o.oauth = { tokens: i, request: r }, n.Portal.http(o) } }, i, l, r; t.base = s(t.url).match(/^.{2,5}:\/\/[^/]+/)[0]; n.Portal || (n.Portal = { init: function (n) { if (n) for (var i in n) t.options[i] = n[i] }, getVersion: function () { return t.version }, setVersion: function (n) { t.version = n }, setUrl: function (n) { t.url = n; t.base = s(t.url).match(/^.{2,5}:\/\/[^/]+/)[0] }, create: function (t, i) { var u, r, f; if (!t) return o(n.Portal, !0); u = function (n) { return c(t, i, n) }; r = {}; for (f in t) r[f] = t[f]; return r.get = u("GET"), r.post = u("POST"), r.put = u("PUT"), r.patch = u("PATCH"), r.del = u("DELETE"), r }, clearCache: function () { e(".wps_api_auth") }, auth: function (i, r) { var f, s, c, e; return (f = $.Deferred(), arguments.length === 0 && (i = {}), arguments.length === 1 && typeof i == "function" && (r = i, i = {}), u(i.cache) && (s = o(n.Portal, !0), s)) ? (f != null && f.resolve(s), r ? r(null, s) : f.promise()) : (c = t.url + "/token", e = { cache: i.cache }, e.callback = function (n, t) { return i.callback = function () { }, r ? r(n, t) : undefined }, $.post(c, i).done(function (n, t) { return e.data = { status: t, response: n.data == undefined ? n : n.data }, h(e, f) }).fail(function (n, t) { return e.data = { status: t, response: n }, h(e, f) }), f != null ? f.promise() : void 0) } }, typeof jQuery != "undefined" || t.loadJQuery || Error("jQuery 2.2.1 is required"), typeof jQuery == "undefined" ? (i = [], r = document.createElement("script"), r.src = "//code.jquery.com/jquery-2.2.1.min.js", r.type = "text/javascript", r.onload = function () { a(jQuery); for (var n in i) i[n].fn.apply(null, i[n].args) }, document.getElementsByTagName("head")[0].appendChild(r), l = function (n) { return function () { var t = []; for (var r in arguments) t[r] = arguments[r]; i.push({ fn: n, args: t }) } }, n.Portal.http = l(function () { n.Portal.http.apply(n.Portal, arguments) })) : a(jQuery)) })(this || window)